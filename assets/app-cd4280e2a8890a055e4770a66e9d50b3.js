+function($){var Button=function(element,options){this.$element=$(element);this.options=$.extend({},Button.DEFAULTS,options);this.isLoading=false};Button.DEFAULTS={loadingText:"loading..."};Button.prototype.setState=function(state){var d="disabled";var $el=this.$element;var val=$el.is("input")?"val":"html";var data=$el.data();state=state+"Text";if(!data.resetText){$el.data("resetText",$el[val]())}$el[val](data[state]||this.options[state]);setTimeout($.proxy(function(){if(state=="loadingText"){this.isLoading=true;$el.addClass(d).attr(d,d)}else{if(this.isLoading){this.isLoading=false;$el.removeClass(d).removeAttr(d)}}},this),0)};Button.prototype.toggle=function(){var changed=true;var $parent=this.$element.closest('[data-toggle="buttons"]');if($parent.length){var $input=this.$element.find("input");if($input.prop("type")=="radio"){if($input.prop("checked")&&this.$element.hasClass("active")){changed=false}else{$parent.find(".active").removeClass("active")}}if(changed){$input.prop("checked",!this.$element.hasClass("active")).trigger("change")}}if(changed){this.$element.toggleClass("active")}};var old=$.fn.button;$.fn.button=function(option){return this.each(function(){var $this=$(this);var data=$this.data("bs.button");var options=typeof option=="object"&&option;if(!data){$this.data("bs.button",(data=new Button(this,options)))}if(option=="toggle"){data.toggle()}else{if(option){data.setState(option)}}})};$.fn.button.Constructor=Button;$.fn.button.noConflict=function(){$.fn.button=old;return this};$(document).on("click.bs.button.data-api","[data-toggle^=button]",function(e){var $btn=$(e.target);if(!$btn.hasClass("btn")){$btn=$btn.closest(".btn")}$btn.button("toggle");e.preventDefault()})}(jQuery);jQuery(".btn").button();(function(window,document,undefined){var _MAP={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},_KEYCODE_MAP={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},_SHIFT_MAP={"~":"`","!":"1","@":"2","#":"3","$":"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},_SPECIAL_ALIASES={option:"alt",command:"meta","return":"enter",escape:"esc",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},_REVERSE_MAP,_callbacks={},_directMap={},_sequenceLevels={},_resetTimer,_ignoreNextKeyup=false,_ignoreNextKeypress=false,_nextExpectedAction=false;for(var i=1;i<20;++i){_MAP[111+i]="f"+i}for(i=0;i<=9;++i){_MAP[i+96]=i}function _addEvent(object,type,callback){if(object.addEventListener){object.addEventListener(type,callback,false);return}object.attachEvent("on"+type,callback)}function _characterFromEvent(e){if(e.type=="keypress"){var character=String.fromCharCode(e.which);if(!e.shiftKey){character=character.toLowerCase()}return character}if(_MAP[e.which]){return _MAP[e.which]}if(_KEYCODE_MAP[e.which]){return _KEYCODE_MAP[e.which]}return String.fromCharCode(e.which).toLowerCase()}function _modifiersMatch(modifiers1,modifiers2){return modifiers1.sort().join(",")===modifiers2.sort().join(",")}function _resetSequences(doNotReset){doNotReset=doNotReset||{};var activeSequences=false,key;for(key in _sequenceLevels){if(doNotReset[key]){activeSequences=true;continue}_sequenceLevels[key]=0}if(!activeSequences){_nextExpectedAction=false}}function _getMatches(character,modifiers,e,sequenceName,combination,level){var i,callback,matches=[],action=e.type;if(!_callbacks[character]){return[]}if(action=="keyup"&&_isModifier(character)){modifiers=[character]}for(i=0;i<_callbacks[character].length;++i){callback=_callbacks[character][i];if(!sequenceName&&callback.seq&&_sequenceLevels[callback.seq]!=callback.level){continue}if(action!=callback.action){continue}if((action=="keypress"&&!e.metaKey&&!e.ctrlKey)||_modifiersMatch(modifiers,callback.modifiers)){var deleteCombo=!sequenceName&&callback.combo==combination;var deleteSequence=sequenceName&&callback.seq==sequenceName&&callback.level==level;if(deleteCombo||deleteSequence){_callbacks[character].splice(i,1)}matches.push(callback)}}return matches}function _eventModifiers(e){var modifiers=[];if(e.shiftKey){modifiers.push("shift")}if(e.altKey){modifiers.push("alt")}if(e.ctrlKey){modifiers.push("ctrl")}if(e.metaKey){modifiers.push("meta")}return modifiers}function _preventDefault(e){if(e.preventDefault){e.preventDefault();return}e.returnValue=false}function _stopPropagation(e){if(e.stopPropagation){e.stopPropagation();return}e.cancelBubble=true}function _fireCallback(callback,e,combo,sequence){if(Mousetrap.stopCallback(e,e.target||e.srcElement,combo,sequence)){return}if(callback(e,combo)===false){_preventDefault(e);_stopPropagation(e)}}function _handleKey(character,modifiers,e){var callbacks=_getMatches(character,modifiers,e),i,doNotReset={},maxLevel=0,processedSequenceCallback=false;for(i=0;i<callbacks.length;++i){if(callbacks[i].seq){maxLevel=Math.max(maxLevel,callbacks[i].level)}}for(i=0;i<callbacks.length;++i){if(callbacks[i].seq){if(callbacks[i].level!=maxLevel){continue}processedSequenceCallback=true;doNotReset[callbacks[i].seq]=1;_fireCallback(callbacks[i].callback,e,callbacks[i].combo,callbacks[i].seq);continue}if(!processedSequenceCallback){_fireCallback(callbacks[i].callback,e,callbacks[i].combo)}}var ignoreThisKeypress=e.type=="keypress"&&_ignoreNextKeypress;if(e.type==_nextExpectedAction&&!_isModifier(character)&&!ignoreThisKeypress){_resetSequences(doNotReset)}_ignoreNextKeypress=processedSequenceCallback&&e.type=="keydown"}function _handleKeyEvent(e){if(typeof e.which!=="number"){e.which=e.keyCode}var character=_characterFromEvent(e);if(!character){return}if(e.type=="keyup"&&_ignoreNextKeyup===character){_ignoreNextKeyup=false;return}Mousetrap.handleKey(character,_eventModifiers(e),e)}function _isModifier(key){return key=="shift"||key=="ctrl"||key=="alt"||key=="meta"}function _resetSequenceTimer(){clearTimeout(_resetTimer);_resetTimer=setTimeout(_resetSequences,1000)}function _getReverseMap(){if(!_REVERSE_MAP){_REVERSE_MAP={};for(var key in _MAP){if(key>95&&key<112){continue}if(_MAP.hasOwnProperty(key)){_REVERSE_MAP[_MAP[key]]=key}}}return _REVERSE_MAP}function _pickBestAction(key,modifiers,action){if(!action){action=_getReverseMap()[key]?"keydown":"keypress"}if(action=="keypress"&&modifiers.length){action="keydown"}return action}function _bindSequence(combo,keys,callback,action){_sequenceLevels[combo]=0;function _increaseSequence(nextAction){return function(){_nextExpectedAction=nextAction;++_sequenceLevels[combo];_resetSequenceTimer()}}function _callbackAndReset(e){_fireCallback(callback,e,combo);if(action!=="keyup"){_ignoreNextKeyup=_characterFromEvent(e)}setTimeout(_resetSequences,10)}for(var i=0;i<keys.length;++i){var isFinal=i+1===keys.length;var wrappedCallback=isFinal?_callbackAndReset:_increaseSequence(action||_getKeyInfo(keys[i+1]).action);_bindSingle(keys[i],wrappedCallback,action,combo,i)}}function _keysFromString(combination){if(combination==="+"){return["+"]}return combination.split("+")}function _getKeyInfo(combination,action){var keys,key,i,modifiers=[];keys=_keysFromString(combination);for(i=0;i<keys.length;++i){key=keys[i];if(_SPECIAL_ALIASES[key]){key=_SPECIAL_ALIASES[key]}if(action&&action!="keypress"&&_SHIFT_MAP[key]){key=_SHIFT_MAP[key];modifiers.push("shift")}if(_isModifier(key)){modifiers.push(key)}}action=_pickBestAction(key,modifiers,action);return{key:key,modifiers:modifiers,action:action}}function _bindSingle(combination,callback,action,sequenceName,level){_directMap[combination+":"+action]=callback;combination=combination.replace(/\s+/g," ");var sequence=combination.split(" "),info;if(sequence.length>1){_bindSequence(combination,sequence,callback,action);return}info=_getKeyInfo(combination,action);_callbacks[info.key]=_callbacks[info.key]||[];_getMatches(info.key,info.modifiers,{type:info.action},sequenceName,combination,level);_callbacks[info.key][sequenceName?"unshift":"push"]({callback:callback,modifiers:info.modifiers,action:info.action,seq:sequenceName,level:level,combo:combination})}function _bindMultiple(combinations,callback,action){for(var i=0;i<combinations.length;++i){_bindSingle(combinations[i],callback,action)}}_addEvent(document,"keypress",_handleKeyEvent);_addEvent(document,"keydown",_handleKeyEvent);_addEvent(document,"keyup",_handleKeyEvent);var Mousetrap={bind:function(keys,callback,action){keys=keys instanceof Array?keys:[keys];_bindMultiple(keys,callback,action);return this},unbind:function(keys,action){return Mousetrap.bind(keys,function(){},action)},trigger:function(keys,action){if(_directMap[keys+":"+action]){_directMap[keys+":"+action]({},keys)}return this},reset:function(){_callbacks={};_directMap={};return this},stopCallback:function(e,element){if((" "+element.className+" ").indexOf(" mousetrap ")>-1){return false}return element.tagName=="INPUT"||element.tagName=="SELECT"||element.tagName=="TEXTAREA"||element.isContentEditable},handleKey:_handleKey};window.Mousetrap=Mousetrap;if(typeof define==="function"&&define.amd){define(Mousetrap)}})(window,document);(function(){if(window.google&&google.gears){return}var F=null;if(typeof GearsFactory!="undefined"){F=new GearsFactory()}else{try{F=new ActiveXObject("Gears.Factory");if(F.getBuildInfo().indexOf("ie_mobile")!=-1){F.privateSetGlobalObject(this)}}catch(e){if((typeof navigator.mimeTypes!="undefined")&&navigator.mimeTypes["application/x-googlegears"]){F=document.createElement("object");F.style.display="none";F.width=0;F.height=0;F.type="application/x-googlegears";document.documentElement.appendChild(F)}}}if(!F){return}if(!window.google){google={}}if(!google.gears){google.gears={factory:F}}})();Persist=(function(){var VERSION="0.3.1",P,B,esc,init,empty,ec;ec=(function(){var EPOCH="Thu, 01-Jan-1970 00:00:01 GMT",RATIO=1000*60*60*24,KEYS=["expires","path","domain"],esc=escape,un=unescape,doc=document,me;var get_now=function(){var r=new Date();r.setTime(r.getTime());return r};var cookify=function(c_key,c_val){var i,key,val,r=[],opt=(arguments.length>2)?arguments[2]:{};r.push(esc(c_key)+"="+esc(c_val));for(var idx=0;idx<KEYS.length;idx++){key=KEYS[idx];val=opt[key];if(val){r.push(key+"="+val)}}if(opt.secure){r.push("secure")}return r.join("; ")};var alive=function(){var k="__EC_TEST__",v=new Date();v=v.toGMTString();this.set(k,v);this.enabled=(this.remove(k)==v);return this.enabled};me={set:function(key,val){var opt=(arguments.length>2)?arguments[2]:{},now=get_now(),expire_at,cfg={};if(opt.expires){if(opt.expires==-1){cfg.expires=-1}else{var expires=opt.expires*RATIO;cfg.expires=new Date(now.getTime()+expires);cfg.expires=cfg.expires.toGMTString()}}var keys=["path","domain","secure"];for(var i=0;i<keys.length;i++){if(opt[keys[i]]){cfg[keys[i]]=opt[keys[i]]}}var r=cookify(key,val,cfg);doc.cookie=r;return val},has:function(key){key=esc(key);var c=doc.cookie,ofs=c.indexOf(key+"="),len=ofs+key.length+1,sub=c.substring(0,key.length);return((!ofs&&key!=sub)||ofs<0)?false:true},get:function(key){key=esc(key);var c=doc.cookie,ofs=c.indexOf(key+"="),len=ofs+key.length+1,sub=c.substring(0,key.length),end;if((!ofs&&key!=sub)||ofs<0){return null}end=c.indexOf(";",len);if(end<0){end=c.length}return un(c.substring(len,end))},remove:function(k){var r=me.get(k),opt={expires:EPOCH};doc.cookie=cookify(k,"",opt);return r},keys:function(){var c=doc.cookie,ps=c.split("; "),i,p,r=[];for(var idx=0;idx<ps.length;idx++){p=ps[idx].split("=");r.push(un(p[0]))}return r},all:function(){var c=doc.cookie,ps=c.split("; "),i,p,r=[];for(var idx=0;idx<ps.length;idx++){p=ps[idx].split("=");r.push([un(p[0]),un(p[1])])}return r},version:"0.2.1",enabled:false};me.enabled=alive.call(me);return me}());var index_of=(function(){if(Array.prototype.indexOf){return function(ary,val){return Array.prototype.indexOf.call(ary,val)}}else{return function(ary,val){var i,l;for(var idx=0,len=ary.length;idx<len;idx++){if(ary[idx]==val){return idx}}return -1}}})();empty=function(){};esc=function(str){return"PS"+str.replace(/_/g,"__").replace(/ /g,"_s")};var C={search_order:["localstorage","globalstorage","gears","cookie","ie","flash"],name_re:/^[a-z][a-z0-9_ \-]+$/i,methods:["init","get","set","remove","load","save","iterate"],sql:{version:"1",create:"CREATE TABLE IF NOT EXISTS persist_data (k TEXT UNIQUE NOT NULL PRIMARY KEY, v TEXT NOT NULL)",get:"SELECT v FROM persist_data WHERE k = ?",set:"INSERT INTO persist_data(k, v) VALUES (?, ?)",remove:"DELETE FROM persist_data WHERE k = ?",keys:"SELECT * FROM persist_data"},flash:{div_id:"_persist_flash_wrap",id:"_persist_flash",path:"persist.swf",size:{w:1,h:1},params:{autostart:true}}};B={gears:{size:-1,test:function(){return(window.google&&window.google.gears)?true:false},methods:{init:function(){var db;db=this.db=google.gears.factory.create("beta.database");db.open(esc(this.name));db.execute(C.sql.create).close()},get:function(key){var r,sql=C.sql.get;var db=this.db;var ret;db.execute("BEGIN").close();r=db.execute(sql,[key]);ret=r.isValidRow()?r.field(0):null;r.close();db.execute("COMMIT").close();return ret},set:function(key,val){var rm_sql=C.sql.remove,sql=C.sql.set,r;var db=this.db;var ret;db.execute("BEGIN").close();db.execute(rm_sql,[key]).close();db.execute(sql,[key,val]).close();db.execute("COMMIT").close();return val},remove:function(key){var get_sql=C.sql.get,sql=C.sql.remove,r,val=null,is_valid=false;var db=this.db;db.execute("BEGIN").close();db.execute(sql,[key]).close();db.execute("COMMIT").close();return true},iterate:function(fn,scope){var key_sql=C.sql.keys;var r;var db=this.db;r=db.execute(key_sql);while(r.isValidRow()){fn.call(scope||this,r.field(0),r.field(1));r.next()}r.close()}}},globalstorage:{size:5*1024*1024,test:function(){if(window.globalStorage){var domain="127.0.0.1";if(this.o&&this.o.domain){domain=this.o.domain}try{var dontcare=globalStorage[domain];return true}catch(e){if(window.console&&window.console.warn){console.warn("globalStorage exists, but couldn't use it because your browser is running on domain:",domain)}return false}}else{return false}},methods:{key:function(key){return esc(this.name)+esc(key)},init:function(){this.store=globalStorage[this.o.domain]},get:function(key){key=this.key(key);return this.store.getItem(key)},set:function(key,val){key=this.key(key);this.store.setItem(key,val);return val},remove:function(key){var val;key=this.key(key);val=this.store.getItem[key];this.store.removeItem(key);return val}}},localstorage:{size:-1,test:function(){try{if(window.localStorage&&window.localStorage.setItem("test",null)==undefined){if(/Firefox[\/\s](\d+\.\d+)/.test(navigator.userAgent)){var ffVersion=RegExp.$1;if(ffVersion>=9){return true}if(window.location.protocol=="file:"){return false}}else{return true}}else{return false}return window.localStorage?true:false}catch(e){return false}},methods:{key:function(key){return this.name+">"+key},init:function(){this.store=localStorage},get:function(key){key=this.key(key);return this.store.getItem(key)},set:function(key,val){key=this.key(key);this.store.setItem(key,val);return val},remove:function(key){var val;key=this.key(key);val=this.store.getItem(key);this.store.removeItem(key);return val},iterate:function(fn,scope){var l=this.store,key,keys;for(var i=0;i<l.length;i++){key=l.key(i);keys=key.split(">");if((keys.length==2)&&(keys[0]==this.name)){fn.call(scope||this,keys[1],l.getItem(key))}}}}},ie:{prefix:"_persist_data-",size:64*1024,test:function(){return window.ActiveXObject?true:false},make_userdata:function(id){var el=document.createElement("div");el.id=id;el.style.display="none";el.addBehavior("#default#userdata");document.body.appendChild(el);return el},methods:{init:function(){var id=B.ie.prefix+esc(this.name);this.el=B.ie.make_userdata(id);if(this.o.defer){this.load()}},get:function(key){var val;key=esc(key);if(!this.o.defer){this.load()}val=this.el.getAttribute(key);return val},set:function(key,val){key=esc(key);this.el.setAttribute(key,val);if(!this.o.defer){this.save()}return val},remove:function(key){var val;key=esc(key);if(!this.o.defer){this.load()}val=this.el.getAttribute(key);this.el.removeAttribute(key);if(!this.o.defer){this.save()}return val},load:function(){this.el.load(esc(this.name))},save:function(){this.el.save(esc(this.name))}}},cookie:{delim:":",size:4000,test:function(){return P.Cookie.enabled?true:false},methods:{key:function(key){return this.name+B.cookie.delim+key},get:function(key,fn){var val;key=this.key(key);val=ec.get(key);return val},set:function(key,val,fn){key=this.key(key);ec.set(key,val,this.o);return val},remove:function(key,val){var val;key=this.key(key);val=ec.remove(key);return val}}},flash:{test:function(){try{if(!swfobject){return false}}catch(e){return false}var major=swfobject.getFlashPlayerVersion().major;return(major>=8)?true:false},methods:{init:function(){if(!B.flash.el){var key,el,fel,cfg=C.flash;el=document.createElement("div");el.id=cfg.div_id;fel=document.createElement("div");fel.id=cfg.id;el.appendChild(fel);document.body.appendChild(el);B.flash.el=swfobject.createSWF({id:cfg.id,data:this.o.swf_path||cfg.path,width:cfg.size.w,height:cfg.size.h},cfg.params,cfg.id)}this.el=B.flash.el},get:function(key){var val;key=esc(key);val=this.el.get(this.name,key);return val},set:function(key,val){var old_val;key=esc(key);old_val=this.el.set(this.name,key,val);return old_val},remove:function(key){var val;key=esc(key);val=this.el.remove(this.name,key);return val}}}};init=function(){var i,l,b,key,fns=C.methods,keys=C.search_order;for(var idx=0,len=fns.length;idx<len;idx++){P.Store.prototype[fns[idx]]=empty}P.type=null;P.size=-1;for(var idx2=0,len2=keys.length;!P.type&&idx2<len2;idx2++){b=B[keys[idx2]];if(b.test()){P.type=keys[idx2];P.size=b.size;for(key in b.methods){P.Store.prototype[key]=b.methods[key]}}}P._init=true};P={VERSION:VERSION,type:null,size:0,add:function(o){B[o.id]=o;C.search_order=[o.id].concat(C.search_order);init()},remove:function(id){var ofs=index_of(C.search_order,id);if(ofs<0){return}C.search_order.splice(ofs,1);delete B[id];init()},Cookie:ec,Store:function(name,o){if(!C.name_re.exec(name)){throw new Error("Invalid name")}if(!P.type){throw new Error("No suitable storage found")}o=o||{};this.name=name;o.domain=o.domain||location.hostname||"localhost";o.domain=o.domain.replace(/:\d+$/,"");o.domain=(o.domain=="localhost")?"":o.domain;this.o=o;o.expires=o.expires||365*2;o.path=o.path||"/";if(this.o.search_order){C.search_order=this.o.search_order;init()}this.init()}};init();return P})();var LANES=["left","mid","right"];var GameInterface=(function(){function GameInterface(){}GameInterface.prototype.setDefaultSettings=function(){if($("label.active input[name=difficulty]").length===0){$("#dif-medium").parent().addClass("active")}if($("label.active input[name=speed]").length===0){$("#spd-medium").parent().addClass("active")}if($("label.active input[name=duration]").length===0){$("#dur-medium").parent().addClass("active")}};GameInterface.prototype.getSettings=function(){this.setDefaultSettings();var settings={};if($("label.active input[name=difficulty]").prop("id")==="dif-easy"){settings.difficulty="Easy"}else{if($("label.active input[name=difficulty]").prop("id")==="dif-hard"){settings.difficulty="Hard"}else{settings.difficulty="Medium"}}if($("label.active input[name=speed]").prop("id")==="spd-slow"){settings.speed="Slow"}else{if($("label.active input[name=speed]").prop("id")==="spd-fast"){settings.speed="Fast"}else{settings.speed="Medium"}}if($("label.active input[name=duration]").prop("id")==="dur-sprint"){settings.duration="Sprint"}else{if($("label.active input[name=duration]").prop("id")==="dur-short"){settings.duration="Short"}else{if($("label.active input[name=duration]").prop("id")==="dur-long"){settings.duration="Long"}else{if($("label.active input[name=duration]").prop("id")==="dur-epic"){settings.duration="Epic"}else{settings.duration="Medium"}}}}settings.wallpaper=$("#wallpaper").prop("checked");settings.keymap=$("#keyboard").val();if($.inArray(settings.keymap,["default","oneline","numpad","lefthand"])===-1){settings.keymap="default"}settings.showHint=$("#show-hint").prop("checked");return settings};GameInterface.prototype.getChosenCreeps=function(){var creeps=[];for(var i=0;i<3;i++){var lane=LANES[i];var value=$("label.active input[name=move-"+lane+"]").val();if(value===undefined){value="paper";$("#"+lane+"-paper").parent().addClass("active")}creeps.push(value)}return creeps};return GameInterface})();var GameData=(function(){function GameData(settings,store){this.importSettings(settings);this.lanes={player1:{left:[],mid:[],right:[]},player2:{left:[],mid:[],right:[]}};this.barracks={player1:{left:"paper",mid:"paper",right:"paper"},player2:{}};for(var i=0;i<3;i++){this.barracks.player2[LANES[i]]=["rock","paper","scissors"][Math.floor(Math.random()*3)]}this.results={};this.turn=0;this.draws=0;this.player1Score=0;this.store=store}GameData.prototype.importSettings=function(settings){this.difficulty=settings.difficulty;this.changeChance=GameData.INITIAL_VALUES.difficulty[this.difficulty]["chance"];this.speed=settings.speed;this.interval=GameData.INITIAL_VALUES.speed[this.speed]["interval"];this.animationDelay=GameData.INITIAL_VALUES.speed[this.speed]["animationDelay"];this.duration=settings.duration;var initialHealth=GameData.INITIAL_VALUES.duration[this.duration];this.health={player1:{left:initialHealth.sideShield,mid:initialHealth.midShield,right:initialHealth.sideShield,base:initialHealth.base},player2:{left:initialHealth.sideShield,mid:initialHealth.midShield,right:initialHealth.sideShield,base:initialHealth.base}};this.wallpaper=settings.wallpaper;this.keymap=settings.keymap;this.showHint=settings.showHint};GameData.prototype.upShields=function(player){var shields=3;for(var i=0;i<3;i++){if(this.health[player][LANES[i]]===0){shields--}}return shields};GameData.prototype.baseDamaged=function(player){return this.health[player]["base"]<GameData.INITIAL_VALUES.duration[this.duration]["base"]};GameData.prototype.currentScore=function(){var initialHealth=GameData.INITIAL_VALUES.duration[this.duration];return(this.player1Score*3)+(this.draws)+(initialHealth.sideShield*(3-this.upShields("player2"))*20)+(this.health.player2["base"]<1?initialHealth.base*50:0)};GameData.prototype.gameMode=function(){return(this.wallpaper?"Auto/":"")+this.difficulty+"/"+this.speed+"/"+this.duration},GameData.prototype.getHighScore=function(){var highScore=this.store.get(this.gameMode()+"-score");if(highScore===null||isNaN(highScore)){highScore=0}return highScore};GameData.prototype.updateHighScore=function(){var score=this.currentScore();if(this.getHighScore()<score){this.store.set(this.gameMode()+"-score",score)}};GameData.prototype.getTopSpeed=function(){var topSpeed=this.store.get(this.gameMode()+"-turns");if(topSpeed===null||isNaN(topSpeed)){topSpeed="-"}return topSpeed};GameData.prototype.updateTopSpeed=function(){if(this.getTopSpeed()==="-"||this.getTopSpeed()>this.turn){Store.set(this.gameMode()+"-turns",this.turn)}};GameData.INITIAL_VALUES={difficulty:{Easy:{chance:20},Medium:{chance:40},Hard:{chance:100}},speed:{Slow:{interval:4000,animationDelay:500},Medium:{interval:1500,animationDelay:300},Fast:{interval:700,animationDelay:200}},duration:{Sprint:{sideShield:1,midShield:2,base:4},Short:{sideShield:4,midShield:8,base:10},Medium:{sideShield:10,midShield:20,base:20},Long:{sideShield:20,midShield:40,base:50},Epic:{sideShield:40,midShield:80,base:100}}};return GameData})();var GameRenderer=(function(){function GameRenderer(data){this.setKeyboardShortcuts(data.keymap);this.hideOrDisplayButtons(data);this.clearAllSprites();this.updateScoreDisplay(data);this.showTopScore(data)}GameRenderer.KEYMAP={"default":{"left-rock":"s","left-paper":"d","left-scissors":"f","mid-rock":"r","mid-paper":"t/y","mid-scissors":"u","right-rock":"j","right-paper":"k","right-scissors":"l",pause:"space",options:"esc"},oneline:{"left-rock":"a","left-paper":"s","left-scissors":"d","mid-rock":"f","mid-paper":"g","mid-scissors":"h","right-rock":"j","right-paper":"k","right-scissors":"l",pause:"space",options:"esc"},numpad:{"left-rock":"7","left-paper":"4","left-scissors":"1","mid-rock":"8","mid-paper":"5","mid-scissors":"2","right-rock":"9","right-paper":"6","right-scissors":"3",pause:"+",options:"0"},lefthand:{"left-rock":"q","left-paper":"a","left-scissors":"z","mid-rock":"w","mid-paper":"s","mid-scissors":"x","right-rock":"e","right-paper":"d","right-scissors":"c",pause:"space",options:"esc"}};GameRenderer.prototype.setKeyboardShortcuts=function(keymapChoice){if(GameRenderer.KEYMAP[keymapChoice]==undefined){keymapChoice="default"}var kmap=GameRenderer.KEYMAP[keymapChoice];for(var id in kmap){var keys=kmap[id].split("/");for(var i=0;i<keys.length;i++){(function(key,iid){Mousetrap.bind(key,function(){$("#"+iid).click()})})(keys[i],id)}$("#"+id+"-hint").text(kmap[id])}};GameRenderer.prototype.rebindOption=function(keymapChoice,id){var keys=GameRenderer.KEYMAP[keymapChoice]["options"].split("/");for(var i=0;i<keys.length;i++){(function(key,iid){Mousetrap.bind(key,function(){$("#"+iid).click()})})(keys[i],id)}};GameRenderer.prototype.hideOrDisplayButtons=function(data){if(data.wallpaper){$(".controls .btn-group").hide()}else{$(".controls .btn-group").show()}if(data.showHint){$(".hint").show()}else{$(".hint").hide()}};GameRenderer.prototype.clearAllSprites=function(){for(var i=1;i<=15;i++){$("#l"+i+"-f").hide();$("#m"+i+"-f").hide();$("#r"+i+"-f").hide()}$("#l10-b, #m6-b, #r10-b, #l6-b, #m2-b, #r6-b").removeClass("fa-sun-o").addClass("fa-shield");$("#player-base").text("");$("#player-shields").text("");$("#player-result").text("");$("#enemy-base").text("");$("#enemy-shields").text("");$("#enemy-result").text("");this.clearBattleResults()};GameRenderer.prototype.clearBattleResults=function(){for(var i=1;i<=15;i++){$("#l"+i).removeClass();$("#m"+i).removeClass();$("#r"+i).removeClass()}};GameRenderer.prototype.getDirection=function(player,lane,creep){if(player=="player1"){if(lane=="left"){if(creep.loc<5){return"left"}else{if(creep.loc<12){return"leftLane"}else{if(creep.loc<15){return"rightTop"}}}}else{if(lane=="mid"){if(creep.loc<7){return"midLane"}}else{if(lane=="right"){if(creep.loc<5){return"right"}else{if(creep.loc<12){return"rightLane"}else{if(creep.loc<15){return"leftTop"}}}}}}}else{if(lane=="left"){if(creep.loc>11){return"rightTop"}else{if(creep.loc>4){return"leftLane"}else{if(creep.loc>1){return"left"}}}}else{if(lane=="mid"){if(creep.loc>1){return"midLane"}}else{if(lane=="right"){if(creep.loc>11){return"leftTop"}else{if(creep.loc>4){return"rightLane"}else{if(creep.loc>1){return"right"}}}}}}}return"outOfBounds"};GameRenderer.prototype.removeDestroyedShield=function(data,loc){var shields={l10:{player:"player2",loc:"left"},m6:{player:"player2",loc:"mid"},r10:{player:"player2",loc:"right"},l6:{player:"player1",loc:"left"},m2:{player:"player1",loc:"mid"},r6:{player:"player1",loc:"right"}};var shield=shields[loc];if(data.health[shield.player][shield.loc]===0){$("#"+loc+"-b").removeClass("fa-shield").addClass("fa-sun-o")}};GameRenderer.prototype.drawSprites=function(data){if(data.turn<1){return}var player="player"+((data.turn-1)%2+1);for(var i=0;i<3;i++){var l=LANES[i];for(var j=0;j<data.lanes[player][l].length;j++){var creep=data.lanes[player][l][j];var direction=this.getDirection(player,l,creep);if(direction!="outOfBounds"){var iid="#"+l[0]+creep.loc+"-f";var clearClass=GameRenderer.SPRITE_CLASSES[direction]["clear"];var addClass=GameRenderer.SPRITE_CLASSES[direction][creep.value][player]+(player=="player1"?" pl":"");(function(iid,clearClass,addClass,animationDelay){var drawFunc=function(){$(iid).hide().removeClass(clearClass).addClass(addClass).fadeIn(animationDelay)};if($(iid).is(":visible")&&((player=="player1"&&$(iid).is(".pl"))||(player=="player2"&&!$(iid).is(".pl")))){$(iid).fadeOut(animationDelay,drawFunc)}else{setTimeout(drawFunc,animationDelay)}})(iid,clearClass,addClass,data.animationDelay)}else{$("#"+l[0]+creep.loc+"-f").hide()}}}var _data=data;var _this=this;setTimeout(function(){for(var loc in _data.results){$("#"+loc).addClass(_data.results[loc]);if((_data.results[loc]==="r-lose"&&$.inArray(loc,["l1","m1","r1"])!==-1)||(_data.results[loc]==="r-win"&&$.inArray(loc,["l15","m7","r15"])!==-1)){if($("#"+loc+"-b.fa-ban").length>0){$("#"+loc+"-f").delay(data.animationDelay).hide()}}if((_data.results[loc]==="r-win"&&$.inArray(loc,["l10","m6","r10"])!==-1)||(_data.results[loc]==="r-lose"&&$.inArray(loc,["l6","m2","r6"])!==-1)){if($("#"+loc+"-b.fa-shield").length>0){$("#"+loc+"-f").delay(data.animationDelay).hide()}_this.removeDestroyedShield(_data,loc)}}$(".r-draw .fa-stack-1x").delay(data.animationDelay).hide()},data.animationDelay*1.2)};GameRenderer.prototype.updateScoreDisplay=function(data){$("#turn").html(data.turn);$("#game-score").text(data.currentScore());$("#p1base-health").text(data.health.player1["base"]);$("#p2base-health").text(data.health.player2["base"]);$("#p1shield1-health").text(data.health.player1["left"]);$("#p1shield2-health").text(data.health.player1["mid"]);$("#p1shield3-health").text(data.health.player1["right"]);$("#p2shield1-health").text(data.health.player2["left"]);$("#p2shield2-health").text(data.health.player2["mid"]);$("#p2shield3-health").text(data.health.player2["right"]);var playerShields=data.upShields("player1");if(playerShields==2){$("#player-shields").html("You've lost a shield!<br>2 remain.")}else{if(playerShields==1){$("#player-shields").html("You've lost another<br>shield! One remains.")}else{if(playerShields==0){$("#player-shields").html("You have no more<br>shields!")}}}var enemyShields=data.upShields("player2");if(enemyShields==2){$("#enemy-shields").html("You've destroyed a<br>shield! 2 remain.")}else{if(enemyShields==1){$("#enemy-shields").html("You've destroyed another<br>shield! One remains.")}else{if(enemyShields==0){$("#enemy-shields").html("You have destroyed<br>all shields!")}}}if(data.baseDamaged("player1")){$("#player-base").html("Your base is taking<br>damage!")}if(data.baseDamaged("player2")){$("#enemy-base").html("You're dealing damage<br>to the enemy base!")}};GameRenderer.prototype.showTopScore=function(data){$("#game-mode").text("("+data.gameMode().split("/").join(", ")+")");$("#high-score").text(data.getHighScore());$("#top-speed").text(data.getTopSpeed())};GameRenderer.prototype.displayEndResult=function(data){if(data.health.player1["base"]<1){$("#player-result").html("You lost!")}else{if(data.health.player2["base"]<1){$("#enemy-result").html("You won!")}}this.showTopScore(data);$(".controls .btn-group").hide();$("#pause").hide()};GameRenderer.prototype.draw=function(data){this.clearBattleResults();this.drawSprites(data);this.updateScoreDisplay(data)};GameRenderer.SPRITE_CLASSES={right:{rock:{player1:"fa-thumbs-up",player2:"fa-thumbs-up fa-flip-horizontal"},paper:{player1:"fa-file",player2:"fa-file"},scissors:{player1:"fa-cut",player2:"fa-cut fa-flip-horizontal"},clear:"fa-thumbs-up fa-flip-horizontal fa-file fa-cut pl"},left:{rock:{player1:"fa-thumbs-up fa-flip-horizontal",player2:"fa-thumbs-up"},paper:{player1:"fa-file",player2:"fa-file"},scissors:{player1:"fa-cut fa-flip-horizontal",player2:"fa-cut"},clear:"fa-thumbs-up fa-flip-horizontal fa-file fa-cut pl"},rightTop:{rock:{player1:"fa-thumbs-down",player2:"fa-thumbs-down fa-flip-horizontal"},paper:{player1:"fa-file",player2:"fa-file"},scissors:{player1:"fa-cut",player2:"fa-cut fa-flip-horizontal"},clear:"fa-thumbs-down fa-flip-horizontal fa-file fa-cut pl"},leftTop:{rock:{player1:"fa-thumbs-down fa-flip-horizontal",player2:"fa-thumbs-down"},paper:{player1:"fa-file",player2:"fa-file"},scissors:{player1:"fa-cut fa-flip-horizontal",player2:"fa-cut"},clear:"fa-thumbs-down fa-flip-horizontal fa-file fa-cut pl"},leftLane:{rock:{player1:"fa-thumbs-down fa-rotate-270",player2:"fa-thumbs-up fa-rotate-90"},paper:{player1:"fa-file",player2:"fa-file"},scissors:{player1:"fa-cut fa-rotate-270",player2:"fa-cut fa-rotate-90"},clear:"fa-thumbs-up fa-thumbs-down fa-rotate-270 fa-rotate-90 fa-file fa-cut pl"},midLane:{rock:{player1:"fa-thumbs-up fa-rotate-270",player2:"fa-thumbs-up fa-rotate-90"},paper:{player1:"fa-file",player2:"fa-file"},scissors:{player1:"fa-cut fa-rotate-270",player2:"fa-cut fa-rotate-90"},clear:"fa-thumbs-up fa-rotate-270 fa-rotate-90 fa-file fa-cut pl"},rightLane:{rock:{player1:"fa-thumbs-up fa-rotate-270",player2:"fa-thumbs-down fa-rotate-90"},paper:{player1:"fa-file",player2:"fa-file"},scissors:{player1:"fa-cut fa-rotate-270",player2:"fa-cut fa-rotate-90"},clear:"fa-thumbs-up fa-thumbs-down fa-rotate-270 fa-rotate-90 fa-file fa-cut pl"}};return GameRenderer})();var Store=new Persist.Store("WDFAC");var Game=(function(store){function Game(){this.gameInterface=new GameInterface();this.data=new GameData(this.gameInterface.getSettings(),store);this.renderer=new GameRenderer(this.data)}Game.prototype.bindOptionToCancel=function(){this.renderer.rebindOption(this.data.keymap,"cancel-new-game")};Game.prototype.rebindOption=function(){this.renderer.rebindOption(this.data.keymap,"options")};Game.prototype.moveCreeps=function(){var player="player"+(this.data.turn%2+1);for(var i=0;i<3;i++){var l=LANES[i];for(var j=0;j<this.data.lanes[player][l].length;j++){var creep=this.data.lanes[player][l][j];creep.loc+=(player==="player1"?1:-1)}}};Game.prototype.spawnCreeps=function(chosenCreeps){var player="player"+(this.data.turn%2+1);for(var i=0;i<3;i++){var l=LANES[i];if(player==="player1"&&!this.data.wallpaper){this.data.barracks[player][l]=chosenCreeps[i]}else{if((player==="player2"||this.data.wallpaper)&&Math.random()*100<this.data.changeChance){this.data.barracks[player][l]=["rock","paper","scissors"][Math.floor(Math.random()*3)]}}this.data.lanes[player][l].push({value:this.data.barracks[player][l],loc:(player==="player1"?1:(l==="mid"?7:15))})}};Game.prototype.resolveCreepBattles=function(){this.data.results={};for(var i=0;i<3;i++){var l=LANES[i];if(this.data.lanes.player1[l].length>0&&this.data.lanes.player2[l].length>0){var creep1=this.data.lanes.player1[l][0];var creep2=this.data.lanes.player2[l][0];if(creep1.loc===creep2.loc){if(creep1.value===creep2.value){this.data.lanes.player1[l].shift();this.data.lanes.player2[l].shift();this.data.draws++;this.data.results[l[0]+creep1.loc]="r-draw"}else{if((creep1.value==="rock"&&creep2.value==="paper")||(creep1.value==="paper"&&creep2.value==="scissors")||(creep1.value==="scissors"&&creep2.value==="rock")){this.data.lanes.player1[l].shift();this.data.results[l[0]+creep1.loc]="r-lose"}else{this.data.lanes.player2[l].shift();this.data.player1Score++;this.data.results[l[0]+creep1.loc]="r-win"}}}}if(this.data.lanes.player1[l].length>0){var creep1=this.data.lanes.player1[l][0];if(creep1.loc===(l==="mid"?6:10)){if(this.data.health.player2[l]>0){this.data.lanes.player1[l].shift();this.data.health.player2[l]--}}if(creep1.loc===(l==="mid"?7:15)){this.data.lanes.player1[l].shift();this.data.health.player2["base"]--;this.data.results[l[0]+creep1.loc]="r-win"}}if(this.data.lanes.player2[l].length>0){var creep2=this.data.lanes.player2[l][0];if(creep2.loc===(l==="mid"?2:6)){if(this.data.health.player1[l]>0){this.data.lanes.player2[l].shift();this.data.health.player1[l]--}}if(creep2.loc===1){this.data.lanes.player2[l].shift();this.data.health.player1["base"]--;this.data.results[l[0]+creep2.loc]="r-lose"}}}};Game.prototype.update=function(){this.moveCreeps();this.spawnCreeps(this.gameInterface.getChosenCreeps());this.resolveCreepBattles();this.data.turn++};Game.prototype.isGameOver=function(){return this.data.health.player1["base"]<1||this.data.health.player2["base"]<1};Game.prototype.checkEndConditions=function(){if(this.isGameOver()){this.data.updateHighScore();if(this.data.health.player2["base"]<1){this.data.updateTopSpeed()}this.renderer.displayEndResult(this.data);clearInterval(this.data.intervalId)}};Game.prototype.run=function(){var _this=this;this.data.intervalId=setInterval(function(){_this.update();_this.renderer.draw(_this.data);_this.checkEndConditions()},this.data.interval)};return Game})(Store);(function($){$(function(){var game;FastClick.attach(document.body);Mousetrap.bind("enter",function(){$("#start-game").click()});function pause(){clearInterval(game.data.intervalId);$("#pause i").removeClass("fa-pause").addClass("fa-play");$("#pause").addClass("btn-danger");$("#pause").off().click(resume)}function resume(){game.run();$("#pause i").removeClass("fa-play-danger").addClass("fa-pause");$("#pause").removeClass("btn-danger");$("#pause").off().click(pause)}$("#pause").click(pause);$("#start-game").click(function(){$("#game-options").slideUp();$("#game-board").slideDown();$("#pause i").removeClass("fa-play-danger").addClass("fa-pause");$("#pause").show().removeClass("btn-danger");game=new Game();game.run();pause()});$("#options").click(function(){game.bindOptionToCancel();pause();$("#cancel-new-game").show();$("#game-board").slideUp();$("#game-options").slideDown()});$("#cancel-new-game").click(function(){$("#game-options").slideUp();$("#game-board").slideDown();game.rebindOption()});$("#show-advanced").click(function(){$("#show-advanced").slideUp();$("#advanced").slideDown();return false})})})(jQuery);